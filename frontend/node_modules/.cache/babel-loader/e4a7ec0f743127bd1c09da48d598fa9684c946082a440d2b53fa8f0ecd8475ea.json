{"ast":null,"code":"router.get(\"/analytics\", async (req, res) => {\n  try {\n    const {\n      year,\n      month\n    } = req.query; // Expects parameters like ?year=2025&month=11\n\n    if (!year || !month) {\n      return res.status(400).json({\n        error: \"Missing year and month parameters (e.g., ?year=2025&month=11).\"\n      });\n    }\n\n    // --- 1. Get total spending and category breakdown ---\n    const totalQuery = `\n            SELECT \n                category,\n                SUM(amount::numeric) AS category_total\n            FROM expenses\n            WHERE \n                EXTRACT(YEAR FROM date::date) = $1 AND \n                EXTRACT(MONTH FROM date::date) = $2\n            GROUP BY category\n            ORDER BY category_total DESC;\n        `;\n    const totalResult = await pool.query(totalQuery, [year, month]);\n    const breakdown = totalResult.rows;\n\n    // Calculate the grand total from the breakdown (since it's grouped)\n    const totalSpending = breakdown.reduce((sum, row) => sum + parseFloat(row.category_total), 0);\n\n    // --- 2. Count unique days with expenses ---\n    // This is necessary for accurate average daily expenditure\n    const uniqueDaysQuery = `\n            SELECT COUNT(DISTINCT date::date) AS unique_days_count\n            FROM expenses\n            WHERE \n                EXTRACT(YEAR FROM date::date) = $1 AND \n                EXTRACT(MONTH FROM date::date) = $2;\n        `;\n    const daysResult = await pool.query(uniqueDaysQuery, [year, month]);\n    const uniqueDays = parseInt(daysResult.rows[0].unique_days_count, 10);\n\n    // --- 3. Calculate Average Daily Expenditure ---\n    let averageDailyExpenditure = 0;\n    if (uniqueDays > 0 && totalSpending > 0) {\n      averageDailyExpenditure = totalSpending / uniqueDays;\n    }\n    res.json({\n      totalSpending: totalSpending.toFixed(2),\n      averageDailyExpenditure: averageDailyExpenditure.toFixed(2),\n      categoryBreakdown: breakdown.map(row => ({\n        category: row.category,\n        total: parseFloat(row.category_total).toFixed(2)\n      }))\n    });\n  } catch (err) {\n    console.error(\"Analytics fetch error:\", err);\n    res.status(500).send(\"Server error during analytics fetch.\");\n  }\n});","map":{"version":3,"names":["router","get","req","res","year","month","query","status","json","error","totalQuery","totalResult","pool","breakdown","rows","totalSpending","reduce","sum","row","parseFloat","category_total","uniqueDaysQuery","daysResult","uniqueDays","parseInt","unique_days_count","averageDailyExpenditure","toFixed","categoryBreakdown","map","category","total","err","console","send"],"sources":["C:/Users/clyde/Desktop/expense-tracker/frontend/src/components/AnalyticsDisplay.js"],"sourcesContent":["router.get(\"/analytics\", async (req, res) => {\r\n    try {\r\n        const { year, month } = req.query; // Expects parameters like ?year=2025&month=11\r\n\r\n        if (!year || !month) {\r\n            return res.status(400).json({ error: \"Missing year and month parameters (e.g., ?year=2025&month=11).\" });\r\n        }\r\n        \r\n        // --- 1. Get total spending and category breakdown ---\r\n        const totalQuery = `\r\n            SELECT \r\n                category,\r\n                SUM(amount::numeric) AS category_total\r\n            FROM expenses\r\n            WHERE \r\n                EXTRACT(YEAR FROM date::date) = $1 AND \r\n                EXTRACT(MONTH FROM date::date) = $2\r\n            GROUP BY category\r\n            ORDER BY category_total DESC;\r\n        `;\r\n        const totalResult = await pool.query(totalQuery, [year, month]);\r\n        const breakdown = totalResult.rows;\r\n        \r\n        // Calculate the grand total from the breakdown (since it's grouped)\r\n        const totalSpending = breakdown.reduce((sum, row) => sum + parseFloat(row.category_total), 0);\r\n        \r\n        // --- 2. Count unique days with expenses ---\r\n        // This is necessary for accurate average daily expenditure\r\n        const uniqueDaysQuery = `\r\n            SELECT COUNT(DISTINCT date::date) AS unique_days_count\r\n            FROM expenses\r\n            WHERE \r\n                EXTRACT(YEAR FROM date::date) = $1 AND \r\n                EXTRACT(MONTH FROM date::date) = $2;\r\n        `;\r\n        const daysResult = await pool.query(uniqueDaysQuery, [year, month]);\r\n        const uniqueDays = parseInt(daysResult.rows[0].unique_days_count, 10);\r\n        \r\n        // --- 3. Calculate Average Daily Expenditure ---\r\n        let averageDailyExpenditure = 0;\r\n        if (uniqueDays > 0 && totalSpending > 0) {\r\n             averageDailyExpenditure = totalSpending / uniqueDays; \r\n        }\r\n\r\n        res.json({\r\n            totalSpending: totalSpending.toFixed(2),\r\n            averageDailyExpenditure: averageDailyExpenditure.toFixed(2),\r\n            categoryBreakdown: breakdown.map(row => ({\r\n                 category: row.category,\r\n                 total: parseFloat(row.category_total).toFixed(2)\r\n            }))\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Analytics fetch error:\", err);\r\n        res.status(500).send(\"Server error during analytics fetch.\");\r\n    }\r\n});"],"mappings":"AAAAA,MAAM,CAACC,GAAG,CAAC,YAAY,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACzC,IAAI;IACA,MAAM;MAAEC,IAAI;MAAEC;IAAM,CAAC,GAAGH,GAAG,CAACI,KAAK,CAAC,CAAC;;IAEnC,IAAI,CAACF,IAAI,IAAI,CAACC,KAAK,EAAE;MACjB,OAAOF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,KAAK,EAAE;MAAiE,CAAC,CAAC;IAC5G;;IAEA;IACA,MAAMC,UAAU,GAAG;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;IACD,MAAMC,WAAW,GAAG,MAAMC,IAAI,CAACN,KAAK,CAACI,UAAU,EAAE,CAACN,IAAI,EAAEC,KAAK,CAAC,CAAC;IAC/D,MAAMQ,SAAS,GAAGF,WAAW,CAACG,IAAI;;IAElC;IACA,MAAMC,aAAa,GAAGF,SAAS,CAACG,MAAM,CAAC,CAACC,GAAG,EAAEC,GAAG,KAAKD,GAAG,GAAGE,UAAU,CAACD,GAAG,CAACE,cAAc,CAAC,EAAE,CAAC,CAAC;;IAE7F;IACA;IACA,MAAMC,eAAe,GAAG;AAChC;AACA;AACA;AACA;AACA;AACA,SAAS;IACD,MAAMC,UAAU,GAAG,MAAMV,IAAI,CAACN,KAAK,CAACe,eAAe,EAAE,CAACjB,IAAI,EAAEC,KAAK,CAAC,CAAC;IACnE,MAAMkB,UAAU,GAAGC,QAAQ,CAACF,UAAU,CAACR,IAAI,CAAC,CAAC,CAAC,CAACW,iBAAiB,EAAE,EAAE,CAAC;;IAErE;IACA,IAAIC,uBAAuB,GAAG,CAAC;IAC/B,IAAIH,UAAU,GAAG,CAAC,IAAIR,aAAa,GAAG,CAAC,EAAE;MACpCW,uBAAuB,GAAGX,aAAa,GAAGQ,UAAU;IACzD;IAEApB,GAAG,CAACK,IAAI,CAAC;MACLO,aAAa,EAAEA,aAAa,CAACY,OAAO,CAAC,CAAC,CAAC;MACvCD,uBAAuB,EAAEA,uBAAuB,CAACC,OAAO,CAAC,CAAC,CAAC;MAC3DC,iBAAiB,EAAEf,SAAS,CAACgB,GAAG,CAACX,GAAG,KAAK;QACpCY,QAAQ,EAAEZ,GAAG,CAACY,QAAQ;QACtBC,KAAK,EAAEZ,UAAU,CAACD,GAAG,CAACE,cAAc,CAAC,CAACO,OAAO,CAAC,CAAC;MACpD,CAAC,CAAC;IACN,CAAC,CAAC;EAEN,CAAC,CAAC,OAAOK,GAAG,EAAE;IACVC,OAAO,CAACxB,KAAK,CAAC,wBAAwB,EAAEuB,GAAG,CAAC;IAC5C7B,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAAC2B,IAAI,CAAC,sCAAsC,CAAC;EAChE;AACJ,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}